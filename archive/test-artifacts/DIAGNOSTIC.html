<!DOCTYPE html>
<html>
<head>
  <title>Diagnostic - Dashboard Metrics</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #9B2F6A; color: white; }
    .good { color: green; font-weight: bold; }
    .bad { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Dashboard Metrics Diagnostic</h1>
  <p>Supabase URL: <span id="url"></span></p>
  <p>Status: <span id="status">Loading...</span></p>

  <h2>Dashboard Metrics Data:</h2>
  <div id="results"></div>

  <script type="module">
    const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE';
    const SUPABASE_KEY = 'YOUR_SUPABASE_KEY_HERE';

    document.getElementById('url').textContent = SUPABASE_URL;

    async function checkData() {
      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/dashboard_metrics?select=*&order=team_member_id`, {
          headers: {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`
          }
        });

        const data = await response.json();

        document.getElementById('status').innerHTML = `<span class="good">✓ Connected - Found ${data.length} records</span>`;

        let html = '<table><tr><th>ID</th><th>Total Asgn</th><th>Active Asgn</th><th>Hours/Week</th><th>Capacity %</th><th>Status</th></tr>';

        for (const row of data) {
          const hours = row.active_hours_per_week || 0;
          const hoursClass = hours > 0 ? 'good' : 'bad';
          html += `<tr>
            <td>${row.team_member_id.substring(0, 8)}...</td>
            <td>${row.total_assignments}</td>
            <td>${row.active_assignments}</td>
            <td class="${hoursClass}">${hours.toFixed(2)} hrs</td>
            <td>${(row.capacity_utilization * 100).toFixed(0)}%</td>
            <td>${row.capacity_status}</td>
          </tr>`;
        }

        html += '</table>';
        document.getElementById('results').innerHTML = html;

      } catch (error) {
        document.getElementById('status').innerHTML = `<span class="bad">✗ Error: ${error.message}</span>`;
        document.getElementById('results').innerHTML = `<pre>${error.stack}</pre>`;
      }
    }

    checkData();
  </script>
</body>
</html>
